{"version":3,"sources":["scripts/main.js"],"names":["getCommentsRequest","wrapper","innerHTML","xhr","XMLHttpRequest","open","serverUrl","send","onreadystatechange","readyState","status","console","error","statusText","comments","JSON","parse","responseText","addComments","i","length","commentTemplate","createCommentTemplate","newComment","document","createElement","appendChild","comment","html","id","name","email","isEdited","is_edited","create_time","text","editCommentTemplate","startEditText","updateCommentsProc","currentId","cancelEditText","getElementById","currentEditBlock","style","display","parentNode","currentText","lastChild","remove","saveEditText","newText","value","updateCommentsRequest","disableEditTextBlock","data","stringify","log","result","disabled","enableEditTextBlock","getFormData","form","forms","feedback","elements","inputName","inputEmail","inputText","inputFile","addEventListener"],"mappings":"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","file":"scripts/main.min.js","sourcesContent":["\"use strict\";\n\n// когда страница (DOM-дерево) полностью загружена, получаем комментарии с сервера getCommentsRequest()\ndocument.addEventListener(\"DOMContentLoaded\", getCommentsRequest);\n\n// url бэкенд сервера\n// var serverUrl = 'https://operun.herokuapp.com/api/';\nvar serverUrl = 'http://93.88.210.4:8080/api/';\n\n// блок в который будут добавлены загруженные с сервера комментарии\nvar wrapper = document.getElementById(\"wrapper\");\n\nvar comments = [];\nvar currentId = null;\nvar updateCommentsProc = false;\n\n// функция получения комментариев с сервера\nfunction getCommentsRequest(){\n\twrapper.innerHTML = \"Загрузка...\";\n\tvar xhr = new XMLHttpRequest();\n\txhr.open('GET', serverUrl+'comments', true);//true - асинхронно\n\txhr.send();\n\txhr.onreadystatechange = function() {\n\t\tif (xhr.readyState != 4){//отправка данных завершена\n\t\t\treturn;\n\t\t}\n\t\tif (xhr.status != 200) {\n\t\t  console.error( xhr.status + ': ' + xhr.statusText );\n\t\t} else {\n\t\t  wrapper.innerHTML = \"\";\n\t\t  comments = JSON.parse(xhr.responseText);\n\n\t\t  //добавляем комментарии на страницу\n\t\t  addComments(comments);\n\t\t}\n\t}\n}\n\n// функция добавления комментариев\nfunction addComments(comments){\n\tfor (var i = comments.length - 1; i >= 0; i--) {\n\t\t// создаем html-блок комментария по шаблону\n\t\tvar commentTemplate = createCommentTemplate(comments[i]);\n\n\t\tvar newComment = document.createElement(\"div\");\n\t \tnewComment.innerHTML = commentTemplate;\n\n\t \t// добавлякм созданый html-блок с комментарием на страницу\n\t\twrapper.appendChild(newComment);\n\t};\n}\n\n// функция создания html-блока комментария\nfunction createCommentTemplate(comment){\n\tvar html = \n\t\t`<div class=\"panel panel-default\" id=\"comment-`+comment.id+`\">\n\t      <div class=\"panel-heading\">\n\t        <div class=\"row\">\n\t          <div class=\"col-sm-6\">\n\t            <h3 class=\"panel-title\">`+comment.name+` (`+comment.email+`)</h3>\n\t          </div>\n\t          <div class=\"col-sm-6\">\n\t            <h5 class=\"panel-title add-date\"><span class=\"admin-edit\">`+isEdited(comment.is_edited)+`</span> `+comment.create_time+`</h5>\n\t          </div>\n\t        </div>\n\t      </div>\n\t      <div class=\"panel-body\" onclick=\"startEditText('`+comment.id+`')\" id=\"text-`+comment.id+`\">`+comment.text+`</div>\n\t    </div>`\n\t;\n\treturn html;\n}\n\n// функция проверки на изменения комметария администратором\nfunction isEdited(is_edited){\n\tif(is_edited == 1){\n\t\treturn \"изменен администратором\";\n\t}\n\treturn \"\";\n}\n\nfunction editCommentTemplate(id, text){\n\tvar html = \n\t\t`<div class=\"panel-body\">\n\t\t\t<textarea class=\"form-control\" id=\"newText\" rows=\"3\" placeholder=\"newText\" >`+text+`</textarea>\n\t\t\t<p>\n\t\t\t<div class=\"form-inline\">\n\t    \t\t<button class=\"btn btn-default\" id=\"saveNewTextBtn\" onclick=\"updateCommentsRequest('`+id+`')\">Сохранить</button>\n\t      \t\t<button class=\"btn btn-default\" id=\"cancelNewTextBtn\" onclick=\"cancelEditText()\">Отмена</button>\n      \t\t</div>\n\t\t</div>`\n\t;\n\treturn html;\n}\n\nfunction startEditText(id){\n\tif(updateCommentsProc){return;}\n\tif(currentId != null){\n\t\tcancelEditText( currentId );\n\t}\n\tcurrentId = id;\t\t\n\tvar text = document.getElementById(\"text-\"+currentId);\n\tvar currentEditBlock = document.createElement(\"div\");\n\tcurrentEditBlock.innerHTML = editCommentTemplate(currentId, text.innerHTML);\n\ttext.style.display=\"none\";\n\ttext.parentNode.appendChild( currentEditBlock );\n}\n\nfunction cancelEditText(){\n\tvar currentText = document.getElementById(\"text-\"+currentId);\n\tcurrentText.style.display=\"block\";\n\tcurrentText.parentNode.lastChild.remove();\n\t\n\tcurrentId = null;\n}\n\nfunction saveEditText(id){\n\tvar currentText = document.getElementById(\"text-\"+id);\n\tvar newText = document.getElementById(\"newText\").value;\n\t// alert(\"alert: \"+updateCommentsRequest(id, newText));\n\tif( updateCommentsRequest(id, newText) ){\n\t\tcurrentText.innerHTML = newText;\n\t}\n\tcurrentText.style.display=\"block\";\n\tcurrentText.parentNode.lastChild.remove();\n}\n\n// функция изменения комментария на сервере\nfunction updateCommentsRequest(id){\n\tdisableEditTextBlock();\n\tupdateCommentsProc = true;\n\n\tvar currentText = document.getElementById(\"text-\"+id);\n\tvar newText = document.getElementById(\"newText\").value;\n\n\tvar xhr = new XMLHttpRequest();\n\tvar data = JSON.stringify({\n  \t\t\t\t\t\tid: id,\n\t\t\t\t\t\tnewText: newText\n\t\t});\n\tconsole.log(data);\n\txhr.open('PUT', serverUrl+'comments', true);//true - асинхронно\n\t// xhr.setRequestHeader('Content-type', 'application/json; charset=utf-8');\n\txhr.send(data);\n\txhr.onreadystatechange = function() {\n\t\tif (xhr.readyState != 4){//отправка данных завершена\n\t\t\treturn;\n\t\t}\n\t\tif (xhr.status != 200) {\n\t\t  console.error( xhr.status + ': ' + xhr.statusText );\n\t\t} else {\n\t\t\tvar result = JSON.parse( xhr.responseText );\n\t\t\tconsole.log(result.status);\n\n\t\t\tif( result.status ){\n\t\t\t\tcurrentId = null;\n\t\t\t\tcurrentText.innerHTML = newText;\n\t\t\t\tcurrentText.style.display=\"block\";\n\t\t\t\tcurrentText.parentNode.lastChild.remove();\n\t\t\t}\n\n\t\t  // JSON.parse();\n\t\t  // JSON.stringify();\n\t\t  // console.log( result[0]['text'] );\n\n\t\t}\n\t\tupdateCommentsProc = false;\n\t}\n}\n\nfunction disableEditTextBlock(){\n\tdocument.getElementById(\"newText\").disabled = true;\n\tdocument.getElementById(\"saveNewTextBtn\").disabled = true;\n\tdocument.getElementById(\"cancelNewTextBtn\").disabled = true;\n}\nfunction enableEditTextBlock(){\n\tdocument.getElementById(\"newText\").disabled = false;\n\tdocument.getElementById(\"saveNewTextBtn\").disabled = false;\n\tdocument.getElementById(\"cancelNewTextBtn\").disabled = false;\n}\n\n// функция получения данных из формы обратной связи\nfunction getFormData(){\n\tvar form = document.forms.feedback;\n\tvar inputName = form.elements.inputName;\n\tvar inputEmail = form.elements.inputEmail;\n\tvar inputText = form.elements.inputText;\n\tvar inputFile = form.elements.inputFile;\t\n}\n\n// function preview(){\n// \tconsole.log(\"preview is started\");\t\n\t// console.log( inputName.value );\n\t// console.log( inputEmail.value );\n\t// console.log( inputText.value );\n// }\n"],"sourceRoot":"/source/"}