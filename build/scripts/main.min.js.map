{"version":3,"sources":["scripts/main.js"],"names":["getCookie","name","matches","document","cookie","match","RegExp","replace","decodeURIComponent","undefined","getCommentsRequest","wrapper","innerHTML","xhr","XMLHttpRequest","withCredentials","open","serverUrl","send","onreadystatechange","readyState","status","console","error","statusText","response","JSON","parse","responseText","user","isadmin","comments","data","addComments","i","length","newComment","createElement","className","setAttribute","commentTemplate","createCommentTemplate","log","newFooter","footerTemplate","createFooterTemplate","appendChild","comment","html","ismoderatedBtnClass","is_moderated","id","email","isEdited","is_edited","create_time","text","footerComment","option","ismoderatedBtnCheck","changeModerateState","stringify","result","editCommentTemplate","startEditText","updateCommentsProc","currentId","cancelEditText","getElementById","currentEditBlock","style","display","parentNode","currentText","lastChild","remove","saveEditText","newText","value","updateCommentsRequest","disableEditTextBlock","disabled","enableEditTextBlock","getFormData","form","forms","feedback","elements","inputName","inputEmail","inputText","inputFile","clearFormData","preview","Date","toLocaleString","preveiwComment","cancelPreview","addCommentRequest","getSigninFormData","signin","credential","login","inputSigninLogin","password","inputSigninPassword","signIn","session_id","showHideAuthForm","alert","signOut","userName","addEventListener","info"],"mappings":"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","file":"scripts/main.min.js","sourcesContent":["\"use strict\";\n\n// когда страница (DOM-дерево) полностью загружена, получаем комментарии с сервера getCommentsRequest()\ndocument.addEventListener(\"DOMContentLoaded\", getCommentsRequest);\n\n// url бэкенд сервера\n var serverUrl = 'https://operun.herokuapp.com/api/';\n//var serverUrl = 'http://93.88.210.4:8080/api/';\n\n// блок в который будут добавлены загруженные с сервера комментарии\nvar wrapper = document.getElementById(\"wrapper\");\n\nvar comments = [];\nvar currentId = null;\nvar updateCommentsProc = false;\nvar user = {\n\tlogin: getCookie(\"userName\") || \"\",\n\tisadmin: false,\n\tsession_id: \"\"\n}\nconsole.log(\"getcookie: \"+getCookie(\"userName\"));\n\n// возвращает cookie с именем name, если есть, если нет, то undefined\nfunction getCookie(name) {\n  var matches = document.cookie.match(new RegExp(\n    \"(?:^|; )\" + name.replace(/([\\.$?*|{}\\(\\)\\[\\]\\\\\\/\\+^])/g, '\\\\$1') + \"=([^;]*)\"\n  ));\n  return matches ? decodeURIComponent(matches[1]) : undefined;\n}\nshowHideAuthForm(user.login);\nconsole.info( document.cookie );\t\n\n// функция получения комментариев с сервера\nfunction getCommentsRequest(){\n\twrapper.innerHTML = \"Загрузка...\";\n\tvar xhr = new XMLHttpRequest();\n\txhr.withCredentials = true;\n\n\txhr.open('GET', serverUrl+'comments', true);//true - асинхронно\n\txhr.send();\n\txhr.onreadystatechange = function() {\n\t\tif (xhr.readyState != 4){//отправка данных завершена\n\t\t\treturn;\n\t\t}\n\t\tif (xhr.status != 200) {\n\t\t  console.error( xhr.status + ': ' + xhr.statusText );\n\t\t} else {\n\t\t\tvar response = JSON.parse(xhr.responseText);\n\t\t\tif(response.status){\n\t\t\t\twrapper.innerHTML = \"\";\n\t\t\t\tuser.isadmin = response.isadmin;\n\t\t\t\tcomments = JSON.parse(response.data);\n\n\t\t\t\t//добавляем комментарии на страницу\n\t\t\t\taddComments(comments, response.isadmin);\n\t\t\t}\t\t  \n\t\t}\n\t}\n}\n\n// функция добавления комментариев\nfunction addComments(comments){\n\tfor (var i = comments.length - 1; i >= 0; i--) {\n\n\t\t// создаем html-блок комментария по шаблону\n\t\tvar newComment = document.createElement(\"div\");\n\t\tnewComment.className = \"panel panel-default\";\n\t\tnewComment.setAttribute(\"id\", \"comment-\"+comments[i]['id']);\n\t\tvar commentTemplate = createCommentTemplate(comments[i]);\n\t \tnewComment.innerHTML = commentTemplate;\n\n\t \tif(user.isadmin){\n\t \t\t// создаем футер html-блока по шаблону\n\t \t\tconsole.log(\"add footer\");\n\t \t\tvar newFooter = document.createElement(\"div\");\n\t \t\tnewFooter.className = \"panel-footer text-right\";\n\t \t\tnewFooter.setAttribute(\"id\", \"footer-\"+comments[i]['id']);\n\t \t\tvar footerTemplate = createFooterTemplate(comments[i]);\n\t \t\tnewFooter.innerHTML = footerTemplate;\n\t \t\tnewComment.appendChild(newFooter);\n\t \t}\n\n\t \t// добавляем созданый html-блок с комментарием на страницу\n\t\twrapper.appendChild(newComment);\n\n\t};\n}\nfunction createFooterTemplate(comment){\n\tvar html =\n\t `\n\t\t<div class=\"btn-group\" data-toggle=\"buttons\" >\n\t\t  <label class=\"btn btn-default btn-xs `+ismoderatedBtnClass(comment.is_moderated, 1)+`\" onclick=\"changeModerateState(`+comment.id+`, 1)\" >\n\t\t    <input type=\"radio\" name=\"options-`+comment.id+`\" id=\"option1-`+comment.id+`\" > принять\n\t\t  </label>\n\t\t  <label class=\"btn btn-default btn-xs `+ismoderatedBtnClass(comment.is_moderated, 2)+`\" onclick=\"changeModerateState(`+comment.id+`, 0)\">\n\t\t    <input type=\"radio\" name=\"options-`+comment.id+`\" id=\"option2-`+comment.id+`\" > отклонить\n\t\t  </label>\n\t\t</div>`\n\t;\n\treturn html;\n\t//autocomplete=\"off\" checked>btn btn-default btn-xs\n\t// `+ismoderatedBtnCheck(comment.is_moderated, 1)+`\n}\n// функция создания html-блока комментария\nfunction createCommentTemplate(comment){\n\tvar html = \n\t\t `<div class=\"panel-heading\">\n\t        <div class=\"row\">\n\t          <div class=\"col-sm-6\">\n\t            <h3 class=\"panel-title\">`+comment.name+` (`+comment.email+`)</h3>\n\t          </div>\n\t          <div class=\"col-sm-6\">\n\t            <h5 class=\"panel-title add-date\"><span class=\"admin-edit\" id=\"isedited-`+comment.id+`\">`+isEdited(comment.is_edited)+`</span> `+comment.create_time+`</h5>\n\t          </div>\n\t        </div>\n\t      </div>\n\t      <div class=\"panel-body\" onclick=\"startEditText('`+comment.id+`')\" id=\"text-`+comment.id+`\">`+comment.text+`</div>\n\t      `\n\t;\n\treturn html;\n}\n\n// функция проверки на изменения комметария администратором\nfunction isEdited(is_edited){\n\tif(is_edited == 1){\n\t\treturn \"изменен администратором\";\n\t}\n\treturn \"\";\n}\nfunction footerComment(){\n\tif(user.isadmin){\n\t\treturn \"block\";\n\t}\n\treturn \"none\";\n}\nfunction ismoderatedBtnClass(is_moderated, option){\n\tif(is_moderated == 1 && option == 1){\n\t\treturn \"active\";\n\t}\n\tif(is_moderated == 0 && option == 2){\n\t\treturn \"active\";\n\t}\n\treturn \"\";\n}\nfunction ismoderatedBtnCheck(is_moderated, option){\n\tif(is_moderated == 1 && option == 1){\n\t\treturn \"checked=true\";\n\t}\n\tif(is_moderated == 0 && option == 2){\n\t\treturn \"checked=true\";\n\t}\n\treturn \"\";\n}\nfunction changeModerateState(id, is_moderated){\n\tvar xhr = new XMLHttpRequest();\n\txhr.withCredentials = true;\n\tvar data = JSON.stringify({\n  \t\t\t\t\t\tid: id,\n\t\t\t\t\t\tis_moderated: is_moderated\n\t\t});\n\n\txhr.open('PUT', serverUrl+'moderate', true);//true - асинхронно\n\txhr.send(data);\n\txhr.onreadystatechange = function() {\n\t\tif (xhr.readyState != 4){//отправка данных завершена\n\t\t\treturn;\n\t\t}\n\t\tif (xhr.status != 200) {\n\t\t  console.error( xhr.status + ': ' + xhr.statusText );\n\t\t} else {\n\t\t\tvar result = JSON.parse( xhr.responseText );\n\t\t\t// console.log(result.status);\n\n\t\t\tif( result.status ){\n\t\t\t\tconsole.log(\"changed\");\n\t\t\t\t// document.getElementById(\"isedited-\"+currentId).innerHTML = \"изменен администратором...\";\n\t\t\t\t// currentId = null;\n\t\t\t\t// currentText.innerHTML = newText;\n\t\t\t\t// currentText.style.display=\"block\";\n\t\t\t\t// currentText.parentNode.lastChild.remove();\n\t\t\t}\n\t\t}\n\t\t// updateCommentsProc = false;\n\t}\n\t\n\t// if(document.getElementById('option1-'+id).checked){\n\t// \tconsole.log(\"check:1\");\n\t// }else{\n\t// \tconsole.log(\"check:2\");\n\t// }\n\t// if(document.getElementById('option2-'+id).checked){\n\t// \tconsole.log(\"check:2\");\n\t// }\n\t// console.log(\"id: \"+ id);\n\t// console.log( document.querySelector('input[name=\"options-'+id+'\"]:checked').id );\n}\n\nfunction editCommentTemplate(id, text){\n\tvar html = \n\t\t`<div class=\"panel-body\">\n\t\t\t<textarea class=\"form-control\" id=\"newText\" rows=\"3\" placeholder=\"newText\" >`+text+`</textarea>\n\t\t\t<p>\n\t\t\t<div class=\"form-inline\" style=\"text-align: right;\">\n\t    \t\t<button class=\"btn btn-default\" id=\"saveNewTextBtn\" onclick=\"updateCommentsRequest('`+id+`')\">Сохранить</button>\n\t      \t\t<button class=\"btn btn-default\" id=\"cancelNewTextBtn\" onclick=\"cancelEditText()\">Отмена</button>\n      \t\t</div>\n\t\t</div>`\n\t;\n\treturn html;\n}\n\nfunction startEditText(id){\n\tif(id === \"preview\"){return;}\n\tif(updateCommentsProc){return;}\n\tif(currentId != null){\n\t\tcancelEditText( currentId );\n\t}\n\tcurrentId = id;\t\t\n\tvar text = document.getElementById(\"text-\"+currentId);\n\tvar currentEditBlock = document.createElement(\"div\");\n\tcurrentEditBlock.innerHTML = editCommentTemplate(currentId, text.innerHTML);\n\ttext.style.display=\"none\";\n\ttext.parentNode.appendChild( currentEditBlock );\n}\n\nfunction cancelEditText(){\n\tvar currentText = document.getElementById(\"text-\"+currentId);\n\tcurrentText.style.display=\"block\";\n\tcurrentText.parentNode.lastChild.remove();\n\t\n\tcurrentId = null;\n}\n\nfunction saveEditText(id){\n\tvar currentText = document.getElementById(\"text-\"+id);\n\tvar newText = document.getElementById(\"newText\").value;\n\t// alert(\"alert: \"+updateCommentsRequest(id, newText));\n\tif( updateCommentsRequest(id, newText) ){\n\t\tcurrentText.innerHTML = newText;\n\t}\n\tcurrentText.style.display=\"block\";\n\tcurrentText.parentNode.lastChild.remove();\n}\n\n// функция изменения комментария на сервере\nfunction updateCommentsRequest(id){\n\tdisableEditTextBlock();\n\tupdateCommentsProc = true;\n\n\tvar currentText = document.getElementById(\"text-\"+id);\n\tvar newText = document.getElementById(\"newText\").value;\n\n\tvar xhr = new XMLHttpRequest();\n\txhr.withCredentials = true;\n\tvar data = JSON.stringify({\n  \t\t\t\t\t\tid: id,\n\t\t\t\t\t\tnewText: newText\n\t\t});\n\n\txhr.open('PUT', serverUrl+'comments', true);//true - асинхронно\n\txhr.send(data);\n\txhr.onreadystatechange = function() {\n\t\tif (xhr.readyState != 4){//отправка данных завершена\n\t\t\treturn;\n\t\t}\n\t\tif (xhr.status != 200) {\n\t\t  console.error( xhr.status + ': ' + xhr.statusText );\n\t\t} else {\n\t\t\tvar result = JSON.parse( xhr.responseText );\n\t\t\t// console.log(result.status);\n\n\t\t\tif( result.status ){\n\t\t\t\tdocument.getElementById(\"isedited-\"+currentId).innerHTML = \"изменен администратором...\";\n\t\t\t\tcurrentId = null;\n\t\t\t\tcurrentText.innerHTML = newText;\n\t\t\t\tcurrentText.style.display=\"block\";\n\t\t\t\tcurrentText.parentNode.lastChild.remove();\n\t\t\t}\n\t\t}\n\t\tupdateCommentsProc = false;\n\t}\n}\n\nfunction disableEditTextBlock(){\n\tdocument.getElementById(\"newText\").disabled = true;\n\tdocument.getElementById(\"saveNewTextBtn\").disabled = true;\n\tdocument.getElementById(\"cancelNewTextBtn\").disabled = true;\n}\nfunction enableEditTextBlock(){\n\tdocument.getElementById(\"newText\").disabled = false;\n\tdocument.getElementById(\"saveNewTextBtn\").disabled = false;\n\tdocument.getElementById(\"cancelNewTextBtn\").disabled = false;\n}\n\n// функция получения данных из формы обратной связи\nfunction getFormData(){\n\tvar form = document.forms.feedback;\n\tvar comment = {\n\t\tname: form.elements.inputName.value,\n\t\temail: form.elements.inputEmail.value,\n\t\ttext: form.elements.inputText.value,\n\t\tinputFile: form.elements.inputFile.value\n\t}\n\treturn comment;\n}\n// функция очистки данных в форме обратной связи\nfunction clearFormData(){\n\tvar form = document.forms.feedback;\n\tform.elements.inputName.value = \"\";\n\tform.elements.inputEmail.value = \"\";\n\tform.elements.inputText.value = \"\";\n\tform.elements.inputFile.value = \"\";\n}\n\nfunction preview(){\n\tvar comment = getFormData();\n\tcomment.id = \"preview\";\n\tcomment.create_time = new Date().toLocaleString(\"ru\");\n\n\tvar preveiwComment = document.createElement(\"div\");\n \tpreveiwComment.innerHTML = createCommentTemplate(comment);\n\n \t// добавляем preview html-блок с комментарием на страницу\n\tdocument.getElementById(\"preview\").appendChild(preveiwComment);\n\n\tdocument.getElementById(\"form-feedback\").style.display = \"none\";\n\tdocument.getElementById(\"previewBtn\").style.display = \"none\";\n\tdocument.getElementById(\"cancelPreviewBtn\").style.display = \"block\";\n}\nfunction cancelPreview(){\n\tdocument.getElementById(\"form-feedback\").style.display = \"block\";\n\tdocument.getElementById(\"comment-preview\").remove();\n\tdocument.getElementById(\"previewBtn\").style.display = \"block\";\n\tdocument.getElementById(\"cancelPreviewBtn\").style.display = \"none\";\n\t\n}\n\n\nfunction addCommentRequest(){\n\t// disableEditTextBlock();\n\tupdateCommentsProc = true;\n\tvar comment = getFormData();\n\n\tvar xhr = new XMLHttpRequest();\n\txhr.withCredentials = true;\n\tvar data = JSON.stringify(comment);\n\n\t// console.log(data);\n\txhr.open('POST', serverUrl+'comments', true);//true - асинхронно\n\t// xhr.setRequestHeader('Content-type', 'application/json; charset=utf-8');\n\txhr.send(data);\n\txhr.onreadystatechange = function() {\n\t\tif (xhr.readyState != 4){//отправка данных завершена\n\t\t\treturn;\n\t\t}\n\t\tif (xhr.status != 200) {\n\t\t  console.error( xhr.status + ': ' + xhr.statusText );\n\t\t} else {\n\t\t\tvar result = JSON.parse( xhr.responseText );\n\t\t\tconsole.log(\"result: \"+result.status);\n\n\t\t\tif( result.status ){\n\t\t\t\t//очищаем форму обратнойсвязи\n\t\t\t\tclearFormData();\n\n\t\t\t\t// currentId = null;\n\t\t\t\t// currentText.innerHTML = newText;\n\t\t\t\t// currentText.style.display=\"block\";\n\t\t\t\t// currentText.parentNode.lastChild.remove();\n\t\t\t}\n\t\t  // JSON.parse();\n\t\t  // JSON.stringify();\n\t\t  // console.log( result[0]['text'] );\n\t\t}\n\t\tupdateCommentsProc = false;\n\t}\n}\n\n// функция получения данных из формы авторизации\nfunction getSigninFormData(){\n\tvar form = document.forms.signin;\n\tvar credential = {\n\t\tlogin: form.elements.inputSigninLogin.value,\n\t\tpassword: form.elements.inputSigninPassword.value\n\t}\n\treturn credential;\n}\nfunction signIn(){\n\tvar credential = getSigninFormData();\n\n\tvar xhr = new XMLHttpRequest();\n\txhr.withCredentials = true;\n\tvar data = JSON.stringify(credential);\n\n\tconsole.log(data);\n\txhr.open('POST', serverUrl+'signin', true);\n\txhr.send(data);\n\txhr.onreadystatechange = function() {\n\t\tif (xhr.readyState != 4){//отправка данных завершена\n\t\t\treturn;\n\t\t}\n\t\tif (xhr.status != 200) {\n\t\t  console.error( xhr.status + ': ' + xhr.statusText );\n\t\t} else {\n\t\t\t// console.log(xhr.responseText);\n\t\t\tvar result = JSON.parse( xhr.responseText );\n\t\t\tconsole.log(\"signIn() session_id: \"+result.session_id);\n\n\t\t\tif( result.status ){\n\t\t\t\t//очищаем форму обратнойсвязи\n\t\t\t\t// clearFormData();\n\t\t\t\tuser.login = result.login;\n\t\t\t\tuser.session_id = result.session_id;\n\t\t\t\tdocument.cookie = \"userName=\"+user.login;//, isadmin=\"+result.isadmin;\n\t\t\t\t// showHideAuthForm(\"show\");\n\t\t\t\tshowHideAuthForm(user.login);\n\t\t\t\t// document.getElementById(\"userLogin\").innerHTML = user.login;\n\t\t\t\t// document.getElementById(\"form-signin\").style.display = \"none\";\n\t\t\t\t// document.getElementById(\"form-signout\").style.display = \"block\";\n\n\t\t\t\tgetCommentsRequest();\n\t\t\t}else{\n\t\t\t\talert(\"Неверный Логин или Пароль !\");\n\t\t\t}\n\t\t}\n\t}\n}\nfunction signOut(){\n\tdocument.cookie = \"userName=\";\n\tvar xhr = new XMLHttpRequest();\n\txhr.withCredentials = true;\n\txhr.open('GET', serverUrl+'signout', true);\n\txhr.send();\n\txhr.onreadystatechange = function() {\n\t\tif (xhr.readyState != 4){//отправка данных завершена\n\t\t\treturn;\n\t\t}\n\t\tif (xhr.status != 200) {\n\t\t  console.error( xhr.status + ': ' + xhr.statusText );\n\t\t} else {\n\t\t\tvar result = JSON.parse( xhr.responseText );\n\t\t\t// console.log(\"signOut stop: \"+xhr.responseText);\n\n\t\t\tif( result.status ){\n\t\t\t\t\n\t\t\t\tuser.login = \"\";\n\t\t\t\tuser.session_id = \"\";\n\t\t\t\tdocument.cookie = \"userName=\";\n\n\t\t\t\t// showHideAuthForm(\"hide\");\n\t\t\t\tshowHideAuthForm(user.login);\n\t\t\t\tgetCommentsRequest();\n\t\t\t}else{\n\t\t\t\talert(\"Ошибка.\");\n\t\t\t}\n\t\t}\n\t}\n\t// document.getElementById(\"form-signin\").style.display = \"block\";\n\t// document.getElementById(\"form-signout\").style.display = \"none\";\n\t// document.getElementById(\"userLogin\").innerHTML = \"\";\t\n}\n\nfunction showHideAuthForm(userName){\n\tif(userName != \"\"){\n\t\t//show form\n\t\tdocument.getElementById(\"userLogin\").innerHTML = user.login;\n\t\tdocument.getElementById(\"form-signin\").style.display = \"none\";\n\t\tdocument.getElementById(\"form-signout\").style.display = \"block\";\n\t}else{\n\t\t//hide form\n\t\tdocument.getElementById(\"userLogin\").innerHTML = user.login;\n\t\tdocument.getElementById(\"form-signin\").style.display = \"block\";\n\t\tdocument.getElementById(\"form-signout\").style.display = \"none\";\n\t}\n}\n\n"],"sourceRoot":"/source/"}