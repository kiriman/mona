{"version":3,"sources":["scripts/main.js"],"names":["getCookie","name","matches","document","cookie","match","RegExp","replace","decodeURIComponent","undefined","getCommentsRequest","wrapper","innerHTML","xhr","XMLHttpRequest","withCredentials","open","serverUrl","send","onreadystatechange","readyState","status","console","error","statusText","response","JSON","parse","responseText","user","isadmin","comments","data","addComments","i","length","newComment","createElement","className","setAttribute","commentTemplate","createCommentTemplate","log","newFooter","footerTemplate","createFooterTemplate","appendChild","comment","html","ismoderatedBtnClass","is_moderated","id","email","isEdited","is_edited","create_time","text","footerComment","option","ismoderatedBtnCheck","changeModerateState","stringify","result","editCommentTemplate","startEditText","updateCommentsProc","currentId","cancelEditText","getElementById","currentEditBlock","style","display","parentNode","lastChild","currentText","remove","saveEditText","newText","value","updateCommentsRequest","disableEditTextBlock","disabled","enableEditTextBlock","getFormData","form","forms","feedback","elements","inputName","inputEmail","inputText","inputFile","clearFormData","preview","validate","Date","toLocaleString","preveiwComment","cancelPreview","addCommentRequest","getSigninFormData","signin","credential","login","inputSigninLogin","password","inputSigninPassword","signIn","session_id","showHideAuthForm","alert","signOut","userName","removeErrorClass","el","removeAllErrorClass","getElementsByClassName","check","regex_name","regex_email","exec","classList","add","addEventListener","info"],"mappings":"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","file":"scripts/main.min.js","sourcesContent":["\"use strict\";\n\n// когда страница (DOM-дерево) полностью загружена, получаем комментарии с сервера getCommentsRequest()\ndocument.addEventListener(\"DOMContentLoaded\", getCommentsRequest);\n\n// url бэкенд сервера\nvar serverUrl = 'https://operun.herokuapp.com/api/';\n // var serverUrl = 'http://93.88.210.4:8080/api/';\n\n// блок в который будут добавлены загруженные с сервера комментарии\nvar wrapper = document.getElementById(\"wrapper\");\n\nvar comments = [];\nvar currentId = null;\nvar updateCommentsProc = false;\nvar user = {\n\tlogin: getCookie(\"userName\") || \"\",\n\tisadmin: false,\n\tsession_id: \"\"\n}\nconsole.log(\"getcookie: \"+getCookie(\"userName\"));\n\n// возвращает cookie с именем name, если есть, если нет, то undefined\nfunction getCookie(name) {\n  var matches = document.cookie.match(new RegExp(\n    \"(?:^|; )\" + name.replace(/([\\.$?*|{}\\(\\)\\[\\]\\\\\\/\\+^])/g, '\\\\$1') + \"=([^;]*)\"\n  ));\n  return matches ? decodeURIComponent(matches[1]) : undefined;\n}\nshowHideAuthForm(user.login);\nconsole.info( document.cookie );\t\n\n// функция получения комментариев с сервера\nfunction getCommentsRequest(){\n\twrapper.innerHTML = \"Загрузка...\";\n\tvar xhr = new XMLHttpRequest();\n\txhr.withCredentials = true;\n\n\txhr.open('GET', serverUrl+'comments', true);//true - асинхронно\n\txhr.send();\n\txhr.onreadystatechange = function() {\n\t\tif (xhr.readyState != 4){//отправка данных завершена\n\t\t\treturn;\n\t\t}\n\t\tif (xhr.status != 200) {\n\t\t  console.error( xhr.status + ': ' + xhr.statusText );\n\t\t} else {\n\t\t\tvar response = JSON.parse(xhr.responseText);\n\t\t\tif(response.status){\n\t\t\t\twrapper.innerHTML = \"\";\n\t\t\t\tuser.isadmin = response.isadmin;\n\t\t\t\tcomments = JSON.parse(response.data);\n\n\t\t\t\t//добавляем комментарии на страницу\n\t\t\t\taddComments(comments, response.isadmin);\n\t\t\t}\t\t  \n\t\t}\n\t}\n}\n\n// функция добавления комментариев\nfunction addComments(comments){\n\tfor (var i = comments.length - 1; i >= 0; i--) {\n\n\t\t// создаем html-блок комментария по шаблону\n\t\tvar newComment = document.createElement(\"div\");\n\t\tnewComment.className = \"panel panel-default\";\n\t\tnewComment.setAttribute(\"id\", \"comment-\"+comments[i]['id']);\n\t\tvar commentTemplate = createCommentTemplate(comments[i]);\n\t \tnewComment.innerHTML = commentTemplate;\n\n\t \tif(user.isadmin){\n\t \t\t// создаем футер html-блока по шаблону\n\t \t\tconsole.log(\"add footer\");\n\t \t\tvar newFooter = document.createElement(\"div\");\n\t \t\tnewFooter.className = \"panel-footer text-right\";\n\t \t\tnewFooter.setAttribute(\"id\", \"footer-\"+comments[i]['id']);\n\t \t\tvar footerTemplate = createFooterTemplate(comments[i]);\n\t \t\tnewFooter.innerHTML = footerTemplate;\n\t \t\tnewComment.appendChild(newFooter);\n\t \t}\n\n\t \t// добавляем созданый html-блок с комментарием на страницу\n\t\twrapper.appendChild(newComment);\n\n\t};\n}\nfunction createFooterTemplate(comment){\n\tvar html =\n\t `\n\t\t<div class=\"btn-group\" data-toggle=\"buttons\" >\n\t\t  <label class=\"btn btn-default btn-xs `+ismoderatedBtnClass(comment.is_moderated, 1)+`\" onclick=\"changeModerateState(`+comment.id+`, 1)\" >\n\t\t    <input type=\"radio\" name=\"options-`+comment.id+`\" id=\"option1-`+comment.id+`\" > принять\n\t\t  </label>\n\t\t  <label class=\"btn btn-default btn-xs `+ismoderatedBtnClass(comment.is_moderated, 2)+`\" onclick=\"changeModerateState(`+comment.id+`, 0)\">\n\t\t    <input type=\"radio\" name=\"options-`+comment.id+`\" id=\"option2-`+comment.id+`\" > отклонить\n\t\t  </label>\n\t\t</div>`\n\t;\n\treturn html;\n\t//autocomplete=\"off\" checked>btn btn-default btn-xs\n\t// `+ismoderatedBtnCheck(comment.is_moderated, 1)+`\n}\n// функция создания html-блока комментария\nfunction createCommentTemplate(comment){\n\tvar html = \n\t\t `<div class=\"panel-heading\">\n\t        <div class=\"row\">\n\t          <div class=\"col-sm-6\">\n\t            <h3 class=\"panel-title\">`+comment.name+` (`+comment.email+`)</h3>\n\t          </div>\n\t          <div class=\"col-sm-6\">\n\t            <h5 class=\"panel-title add-date\"><span class=\"admin-edit\" id=\"isedited-`+comment.id+`\">`+isEdited(comment.is_edited)+`</span> `+comment.create_time+`</h5>\n\t          </div>\n\t        </div>\n\t      </div>\n\t      <div class=\"panel-body\" onclick=\"startEditText('`+comment.id+`')\" id=\"text-`+comment.id+`\">`+comment.text+`</div>\n\t      `\n\t;\n\treturn html;\n}\n\n// функция проверки на изменения комметария администратором\nfunction isEdited(is_edited){\n\tif(is_edited == 1){\n\t\treturn \"изменен администратором\";\n\t}\n\treturn \"\";\n}\nfunction footerComment(){\n\tif(user.isadmin){\n\t\treturn \"block\";\n\t}\n\treturn \"none\";\n}\nfunction ismoderatedBtnClass(is_moderated, option){\n\tif(is_moderated == 1 && option == 1){\n\t\treturn \"active\";\n\t}\n\tif(is_moderated == 0 && option == 2){\n\t\treturn \"active\";\n\t}\n\treturn \"\";\n}\nfunction ismoderatedBtnCheck(is_moderated, option){\n\tif(is_moderated == 1 && option == 1){\n\t\treturn \"checked=true\";\n\t}\n\tif(is_moderated == 0 && option == 2){\n\t\treturn \"checked=true\";\n\t}\n\treturn \"\";\n}\nfunction changeModerateState(id, is_moderated){\n\tvar xhr = new XMLHttpRequest();\n\txhr.withCredentials = true;\n\tvar data = JSON.stringify({\n  \t\t\t\t\t\tid: id,\n\t\t\t\t\t\tis_moderated: is_moderated\n\t\t});\n\n\txhr.open('PUT', serverUrl+'moderate', true);//true - асинхронно\n\txhr.send(data);\n\txhr.onreadystatechange = function() {\n\t\tif (xhr.readyState != 4){//отправка данных завершена\n\t\t\treturn;\n\t\t}\n\t\tif (xhr.status != 200) {\n\t\t  console.error( xhr.status + ': ' + xhr.statusText );\n\t\t} else {\n\t\t\tvar result = JSON.parse( xhr.responseText );\n\t\t\t// console.log(result.status);\n\n\t\t\tif( result.status ){\n\t\t\t\tconsole.log(\"changed\");\n\t\t\t\t// document.getElementById(\"isedited-\"+currentId).innerHTML = \"изменен администратором...\";\n\t\t\t\t// currentId = null;\n\t\t\t\t// currentText.innerHTML = newText;\n\t\t\t\t// currentText.style.display=\"block\";\n\t\t\t\t// currentText.parentNode.lastChild.remove();\n\t\t\t}\n\t\t}\n\t\t// updateCommentsProc = false;\n\t}\n\t\n\t// if(document.getElementById('option1-'+id).checked){\n\t// \tconsole.log(\"check:1\");\n\t// }else{\n\t// \tconsole.log(\"check:2\");\n\t// }\n\t// if(document.getElementById('option2-'+id).checked){\n\t// \tconsole.log(\"check:2\");\n\t// }\n\t// console.log(\"id: \"+ id);\n\t// console.log( document.querySelector('input[name=\"options-'+id+'\"]:checked').id );\n}\n\nfunction editCommentTemplate(id, text){\n\tvar html = \n\t\t`<div class=\"panel-body\">\n\t\t\t<textarea class=\"form-control\" id=\"newText\" rows=\"3\" placeholder=\"newText\" >`+text+`</textarea>\n\t\t\t<p>\n\t\t\t<div class=\"form-inline\" style=\"text-align: right;\">\n\t    \t\t<button class=\"btn btn-default\" id=\"saveNewTextBtn\" onclick=\"updateCommentsRequest('`+id+`')\">Сохранить</button>\n\t      \t\t<button class=\"btn btn-default\" id=\"cancelNewTextBtn\" onclick=\"cancelEditText()\">Отмена</button>\n      \t\t</div>\n\t\t</div>`\n\t;\n\treturn html;\n}\n\nfunction startEditText(id){\n\tif(!user.isadmin){return;}\n\tif(id === \"preview\"){return;}\n\tif(updateCommentsProc){return;}\n\tif(currentId != null){\n\t\tcancelEditText( currentId );\n\t}\n\tcurrentId = id;\t\t\n\tvar text = document.getElementById(\"text-\"+currentId);\n\tvar currentEditBlock = document.createElement(\"div\");\n\tcurrentEditBlock.innerHTML = editCommentTemplate(currentId, text.innerHTML);\n\ttext.style.display=\"none\";//hide current text\n\ttext.parentNode.lastChild.style.display=\"none\";// hide footer\n\ttext.parentNode.appendChild( currentEditBlock );//add edit textarea\n}\n\nfunction cancelEditText(){\n\tvar currentText = document.getElementById(\"text-\"+currentId);\n\tcurrentText.style.display=\"block\";\n\tcurrentText.parentNode.lastChild.remove();\n\tcurrentText.parentNode.lastChild.style.display=\"block\";\n\t\n\tcurrentId = null;\n}\n\nfunction saveEditText(id){\n\tvar currentText = document.getElementById(\"text-\"+id);\n\tvar newText = document.getElementById(\"newText\").value;\n\t// alert(\"alert: \"+updateCommentsRequest(id, newText));\n\tif( updateCommentsRequest(id, newText) ){\n\t\tcurrentText.innerHTML = newText;\n\t}\n\tcurrentText.style.display=\"block\";\n\tcurrentText.parentNode.lastChild.remove();\n}\n\n// функция изменения комментария на сервере\nfunction updateCommentsRequest(id){\n\tdisableEditTextBlock();\n\tupdateCommentsProc = true;\n\n\tvar currentText = document.getElementById(\"text-\"+id);\n\tvar newText = document.getElementById(\"newText\").value;\n\n\tvar xhr = new XMLHttpRequest();\n\txhr.withCredentials = true;\n\tvar data = JSON.stringify({\n  \t\t\t\t\t\tid: id,\n\t\t\t\t\t\tnewText: newText\n\t\t});\n\n\txhr.open('PUT', serverUrl+'comments', true);//true - асинхронно\n\txhr.send(data);\n\txhr.onreadystatechange = function() {\n\t\tif (xhr.readyState != 4){//отправка данных завершена\n\t\t\treturn;\n\t\t}\n\t\tif (xhr.status != 200) {\n\t\t  console.error( xhr.status + ': ' + xhr.statusText );\n\t\t} else {\n\t\t\tvar result = JSON.parse( xhr.responseText );\n\t\t\t// console.log(result.status);\n\n\t\t\tif( result.status ){\n\t\t\t\tdocument.getElementById(\"isedited-\"+currentId).innerHTML = \"изменен администратором...\";\n\t\t\t\tcurrentId = null;\n\t\t\t\tcurrentText.innerHTML = newText;\n\t\t\t\tcurrentText.style.display=\"block\";\n\t\t\t\tcurrentText.parentNode.lastChild.remove();\n\t\t\t}\n\t\t}\n\t\tupdateCommentsProc = false;\n\t}\n}\n\nfunction disableEditTextBlock(){\n\tdocument.getElementById(\"newText\").disabled = true;\n\tdocument.getElementById(\"saveNewTextBtn\").disabled = true;\n\tdocument.getElementById(\"cancelNewTextBtn\").disabled = true;\n}\nfunction enableEditTextBlock(){\n\tdocument.getElementById(\"newText\").disabled = false;\n\tdocument.getElementById(\"saveNewTextBtn\").disabled = false;\n\tdocument.getElementById(\"cancelNewTextBtn\").disabled = false;\n}\n\n// функция получения данных из формы обратной связи\nfunction getFormData(){\n\tvar form = document.forms.feedback;\n\tvar comment = {\n\t\tname: form.elements.inputName.value,\n\t\temail: form.elements.inputEmail.value,\n\t\ttext: form.elements.inputText.value,\n\t\tinputFile: form.elements.inputFile.value\n\t}\n\treturn comment;\n}\n// функция очистки данных в форме обратной связи\nfunction clearFormData(){\n\tvar form = document.forms.feedback;\n\tform.elements.inputName.value = \"\";\n\tform.elements.inputEmail.value = \"\";\n\tform.elements.inputText.value = \"\";\n\tform.elements.inputFile.value = \"\";\n}\n\nfunction preview(){\n\tif(!validate()){return;}\n\tvar comment = getFormData();\n\tcomment.id = \"preview\";\n\tcomment.create_time = new Date().toLocaleString(\"ru\")\n\t\n\tvar preveiwComment = document.createElement(\"div\");\n\tpreveiwComment.className = \"panel panel-default\";\n\tpreveiwComment.setAttribute(\"id\", \"comment-preview\");\n\tvar commentTemplate = createCommentTemplate(comment);\n \tpreveiwComment.innerHTML = commentTemplate;\n\n \t// добавляем preview html-блок с комментарием на страницу\n\tdocument.getElementById(\"preview\").appendChild(preveiwComment);\n\n\tdocument.getElementById(\"form-feedback\").style.display = \"none\";\n\tdocument.getElementById(\"previewBtn\").style.display = \"none\";\n\tdocument.getElementById(\"cancelPreviewBtn\").style.display = \"block\";\n}\nfunction cancelPreview(){\n\tdocument.getElementById(\"form-feedback\").style.display = \"block\";\n\tdocument.getElementById(\"comment-preview\").remove();\n\tdocument.getElementById(\"previewBtn\").style.display = \"block\";\n\tdocument.getElementById(\"cancelPreviewBtn\").style.display = \"none\";\n\t\n}\n\n\nfunction addCommentRequest(){\n\t// disableEditTextBlock();\n\tif(!validate()){return;}\n\tupdateCommentsProc = true;\n\tvar comment = getFormData();\n\n\tvar xhr = new XMLHttpRequest();\n\txhr.withCredentials = true;\n\tvar data = JSON.stringify(comment);\n\n\t// console.log(data);\n\txhr.open('POST', serverUrl+'comments', true);//true - асинхронно\n\t// xhr.setRequestHeader('Content-type', 'application/json; charset=utf-8');\n\txhr.send(data);\n\txhr.onreadystatechange = function() {\n\t\tif (xhr.readyState != 4){//отправка данных завершена\n\t\t\treturn;\n\t\t}\n\t\tif (xhr.status != 200) {\n\t\t  console.error( xhr.status + ': ' + xhr.statusText );\n\t\t} else {\n\t\t\tvar result = JSON.parse( xhr.responseText );\n\t\t\tconsole.log(\"result: \"+result.status);\n\n\t\t\tif( result.status ){\n\t\t\t\t//очищаем форму обратнойсвязи\n\t\t\t\tclearFormData();\n\t\t\t}\n\t\t}\n\t\tupdateCommentsProc = false;\n\t}\n}\n\n// функция получения данных из формы авторизации\nfunction getSigninFormData(){\n\tvar form = document.forms.signin;\n\tvar credential = {\n\t\tlogin: form.elements.inputSigninLogin.value,\n\t\tpassword: form.elements.inputSigninPassword.value\n\t}\n\treturn credential;\n}\nfunction signIn(){\n\tvar credential = getSigninFormData();\n\n\tvar xhr = new XMLHttpRequest();\n\txhr.withCredentials = true;\n\tvar data = JSON.stringify(credential);\n\n\tconsole.log(data);\n\txhr.open('POST', serverUrl+'signin', true);\n\txhr.send(data);\n\txhr.onreadystatechange = function() {\n\t\tif (xhr.readyState != 4){//отправка данных завершена\n\t\t\treturn;\n\t\t}\n\t\tif (xhr.status != 200) {\n\t\t  console.error( xhr.status + ': ' + xhr.statusText );\n\t\t} else {\n\t\t\t// console.log(xhr.responseText);\n\t\t\tvar result = JSON.parse( xhr.responseText );\n\t\t\tconsole.log(\"signIn() session_id: \"+result.session_id);\n\n\t\t\tif( result.status ){\n\t\t\t\tuser.login = result.login;\n\t\t\t\tuser.session_id = result.session_id;\n\t\t\t\tdocument.cookie = \"userName=\"+user.login;\n\t\t\t\tshowHideAuthForm(user.login);\n\t\t\t\tgetCommentsRequest();\n\t\t\t}else{\n\t\t\t\talert(\"Неверный Логин или Пароль !\");\n\t\t\t}\n\t\t}\n\t}\n}\nfunction signOut(){\n\tdocument.cookie = \"userName=\";\n\tvar xhr = new XMLHttpRequest();\n\txhr.withCredentials = true;\n\txhr.open('GET', serverUrl+'signout', true);\n\txhr.send();\n\txhr.onreadystatechange = function() {\n\t\tif (xhr.readyState != 4){//отправка данных завершена\n\t\t\treturn;\n\t\t}\n\t\tif (xhr.status != 200) {\n\t\t  console.error( xhr.status + ': ' + xhr.statusText );\n\t\t} else {\n\t\t\tvar result = JSON.parse( xhr.responseText );\n\n\t\t\tif( result.status ){\n\t\t\t\t\n\t\t\t\tuser.login = \"\";\n\t\t\t\tuser.session_id = \"\";\n\t\t\t\tdocument.cookie = \"userName=\";\n\n\t\t\t\t// showHideAuthForm(\"hide\");\n\t\t\t\tshowHideAuthForm(user.login);\n\t\t\t\tgetCommentsRequest();\n\t\t\t}else{\n\t\t\t\talert(\"Ошибка.\");\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction showHideAuthForm(userName){\n\tif(userName != \"\"){\n\t\t//show form\n\t\tdocument.getElementById(\"userLogin\").innerHTML = user.login;\n\t\tdocument.getElementById(\"form-signin\").style.display = \"none\";\n\t\tdocument.getElementById(\"form-signout\").style.display = \"block\";\n\t}else{\n\t\t//hide form\n\t\tdocument.getElementById(\"userLogin\").innerHTML = user.login;\n\t\tdocument.getElementById(\"form-signin\").style.display = \"block\";\n\t\tdocument.getElementById(\"form-signout\").style.display = \"none\";\n\t}\n}\n\n/*\n\tValidate\n*/\nfunction removeErrorClass(el){\n\tel.parentNode.parentNode.className = \"form-group\";\n}\nfunction removeAllErrorClass(){\n\tvar elements = document.forms.feedback.getElementsByClassName(\"form-group\");\n\tfor (var i = elements.length - 1; i >= 0; i--) {\n\t\telements[i].className = \"form-group\";\n\t};\n}\n// validate() валидация полей ввода \nfunction validate(){\n\tremoveAllErrorClass();\n\n\tvar check = [];\n\t\tcheck['status'] = true;\n\n\tvar regex_name = /[a-zа-яё]+/i;\n\tvar regex_email = /\\S+@\\S+\\.\\S+/;\n\n\tvar comment = getFormData();\n\t\n\t//валидация name\n\tif(regex_name.exec(comment.name) == null){\n\t\tlet el = document.getElementById(\"inputName\");\n\t\tel.parentNode.parentNode.classList.add(\"has-error\");\n\t\tel.addEventListener(\"click\", function(){removeErrorClass(el)});\n\t\tcheck['status'] = false;\n\t}\n\t//валидация email\n\tif(regex_email.exec(comment.email) == null){\n\t\tlet el = document.getElementById(\"inputEmail\");\n\t\tel.parentNode.parentNode.classList.add(\"has-error\");\n\t\tel.addEventListener(\"click\", function(){removeErrorClass(el)});\n\t\tcheck['status'] = false;\n\t}\n\t//валидация на пустое сообщение (на пробелы)\n\tif(comment.text.replace(/\\s/g,'')==''){\n\t\tlet el = document.getElementById(\"inputText\");\n\t\tel.parentNode.parentNode.classList.add(\"has-error\");\n\t\tel.addEventListener(\"click\", function(){removeErrorClass(el)});\n\t\tcheck['status'] = false;\n\t}\n\n\tif(check['status']){\n\t\treturn true;\n\t}\t\n\treturn false;\n}\n"],"sourceRoot":"/source/"}