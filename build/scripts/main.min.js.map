{"version":3,"sources":["scripts/main.js"],"names":["getCommentsRequest","wrapper","innerHTML","xhr","XMLHttpRequest","open","serverUrl","send","onreadystatechange","readyState","status","console","error","statusText","log","responseText","addComments","comments","i","length","commentTemplate","createCommentTemplate","newComment","document","createElement","appendChild","comment","html","id","name","email","isEdited","is_edited","create_time","text","editCommentTemplate","startEditText","updateCommentsProc","currentId","cancelEditText","getElementById","currentEditBlock","style","display","parentNode","currentText","lastChild","remove","saveEditText","newText","value","updateCommentsRequest","disableEditTextBlock","data","JSON","stringify","result","parse","disabled","enableEditTextBlock","getFormData","form","forms","feedback","elements","inputName","inputEmail","inputText","inputFile","clearFormData","preview","Date","toLocaleString","preveiwComment","cancelPreview","addCommentRequest","getSigninFormData","signin","credential","login","inputSigninLogin","password","inputSigninPassword","signIn","session_id","user","alert","signOut","addEventListener"],"mappings":"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","file":"scripts/main.min.js","sourcesContent":["\"use strict\";\n\n// когда страница (DOM-дерево) полностью загружена, получаем комментарии с сервера getCommentsRequest()\ndocument.addEventListener(\"DOMContentLoaded\", getCommentsRequest);\n\n// url бэкенд сервера\nvar serverUrl = 'https://operun.herokuapp.com/api/';\n// var serverUrl = 'http://93.88.210.4:8080/api/';\n\n// блок в который будут добавлены загруженные с сервера комментарии\nvar wrapper = document.getElementById(\"wrapper\");\n\nvar comments = [];\nvar currentId = null;\nvar updateCommentsProc = false;\nvar user = {\n\tlogin: \"\",\n\tsession_id: \"\"\n}\n\n// функция получения комментариев с сервера\nfunction getCommentsRequest(){\n\twrapper.innerHTML = \"Загрузка...\";\n\tvar xhr = new XMLHttpRequest();\n\txhr.open('GET', serverUrl+'comments', true);//true - асинхронно\n\txhr.send();\n\txhr.onreadystatechange = function() {\n\t\tif (xhr.readyState != 4){//отправка данных завершена\n\t\t\treturn;\n\t\t}\n\t\tif (xhr.status != 200) {\n\t\t  console.error( xhr.status + ': ' + xhr.statusText );\n\t\t} else {\n\t\t  wrapper.innerHTML = \"\";\n\t\t  // comments = JSON.parse(xhr.responseText);\n\n\t\t  //добавляем комментарии на страницу\n\t\t  // addComments(comments);\n\t\t  console.log(\"getCommentsRequest session_id: \"+xhr.responseText);\n\t\t}\n\t}\n}\n\n// функция добавления комментариев\nfunction addComments(comments){\n\tfor (var i = comments.length - 1; i >= 0; i--) {\n\t\t// создаем html-блок комментария по шаблону\n\t\tvar commentTemplate = createCommentTemplate(comments[i]);\n\n\t\tvar newComment = document.createElement(\"div\");\n\t \tnewComment.innerHTML = commentTemplate;\n\n\t \t// добавляем созданый html-блок с комментарием на страницу\n\t\twrapper.appendChild(newComment);\n\t};\n}\n\n// функция создания html-блока комментария\nfunction createCommentTemplate(comment){\n\tvar html = \n\t\t`<div class=\"panel panel-default\" id=\"comment-`+comment.id+`\">\n\t      <div class=\"panel-heading\">\n\t        <div class=\"row\">\n\t          <div class=\"col-sm-6\">\n\t            <h3 class=\"panel-title\">`+comment.name+` (`+comment.email+`)</h3>\n\t          </div>\n\t          <div class=\"col-sm-6\">\n\t            <h5 class=\"panel-title add-date\"><span class=\"admin-edit\">`+isEdited(comment.is_edited)+`</span> `+comment.create_time+`</h5>\n\t          </div>\n\t        </div>\n\t      </div>\n\t      <div class=\"panel-body\" onclick=\"startEditText('`+comment.id+`')\" id=\"text-`+comment.id+`\">`+comment.text+`</div>\n\t    </div>`\n\t;\n\treturn html;\n}\n\n// функция проверки на изменения комметария администратором\nfunction isEdited(is_edited){\n\tif(is_edited == 1){\n\t\treturn \"изменен администратором\";\n\t}\n\treturn \"\";\n}\n\nfunction editCommentTemplate(id, text){\n\tvar html = \n\t\t`<div class=\"panel-body\">\n\t\t\t<textarea class=\"form-control\" id=\"newText\" rows=\"3\" placeholder=\"newText\" >`+text+`</textarea>\n\t\t\t<p>\n\t\t\t<div class=\"form-inline\" style=\"text-align: right;\">\n\t    \t\t<button class=\"btn btn-default\" id=\"saveNewTextBtn\" onclick=\"updateCommentsRequest('`+id+`')\">Сохранить</button>\n\t      \t\t<button class=\"btn btn-default\" id=\"cancelNewTextBtn\" onclick=\"cancelEditText()\">Отмена</button>\n      \t\t</div>\n\t\t</div>`\n\t;\n\treturn html;\n}\n\nfunction startEditText(id){\n\tif(id === \"preview\"){return;}\n\tif(updateCommentsProc){return;}\n\tif(currentId != null){\n\t\tcancelEditText( currentId );\n\t}\n\tcurrentId = id;\t\t\n\tvar text = document.getElementById(\"text-\"+currentId);\n\tvar currentEditBlock = document.createElement(\"div\");\n\tcurrentEditBlock.innerHTML = editCommentTemplate(currentId, text.innerHTML);\n\ttext.style.display=\"none\";\n\ttext.parentNode.appendChild( currentEditBlock );\n}\n\nfunction cancelEditText(){\n\tvar currentText = document.getElementById(\"text-\"+currentId);\n\tcurrentText.style.display=\"block\";\n\tcurrentText.parentNode.lastChild.remove();\n\t\n\tcurrentId = null;\n}\n\nfunction saveEditText(id){\n\tvar currentText = document.getElementById(\"text-\"+id);\n\tvar newText = document.getElementById(\"newText\").value;\n\t// alert(\"alert: \"+updateCommentsRequest(id, newText));\n\tif( updateCommentsRequest(id, newText) ){\n\t\tcurrentText.innerHTML = newText;\n\t}\n\tcurrentText.style.display=\"block\";\n\tcurrentText.parentNode.lastChild.remove();\n}\n\n// функция изменения комментария на сервере\nfunction updateCommentsRequest(id){\n\tdisableEditTextBlock();\n\tupdateCommentsProc = true;\n\n\tvar currentText = document.getElementById(\"text-\"+id);\n\tvar newText = document.getElementById(\"newText\").value;\n\n\tvar xhr = new XMLHttpRequest();\n\tvar data = JSON.stringify({\n  \t\t\t\t\t\tid: id,\n\t\t\t\t\t\tnewText: newText\n\t\t});\n\n\txhr.open('PUT', serverUrl+'comments', true);//true - асинхронно\n\txhr.send(data);\n\txhr.onreadystatechange = function() {\n\t\tif (xhr.readyState != 4){//отправка данных завершена\n\t\t\treturn;\n\t\t}\n\t\tif (xhr.status != 200) {\n\t\t  console.error( xhr.status + ': ' + xhr.statusText );\n\t\t} else {\n\t\t\tvar result = JSON.parse( xhr.responseText );\n\t\t\tconsole.log(result.status);\n\n\t\t\tif( result.status ){\n\t\t\t\tcurrentId = null;\n\t\t\t\tcurrentText.innerHTML = newText;\n\t\t\t\tcurrentText.style.display=\"block\";\n\t\t\t\tcurrentText.parentNode.lastChild.remove();\n\t\t\t}\n\t\t}\n\t\tupdateCommentsProc = false;\n\t}\n}\n\nfunction disableEditTextBlock(){\n\tdocument.getElementById(\"newText\").disabled = true;\n\tdocument.getElementById(\"saveNewTextBtn\").disabled = true;\n\tdocument.getElementById(\"cancelNewTextBtn\").disabled = true;\n}\nfunction enableEditTextBlock(){\n\tdocument.getElementById(\"newText\").disabled = false;\n\tdocument.getElementById(\"saveNewTextBtn\").disabled = false;\n\tdocument.getElementById(\"cancelNewTextBtn\").disabled = false;\n}\n\n// функция получения данных из формы обратной связи\nfunction getFormData(){\n\tvar form = document.forms.feedback;\n\tvar comment = {\n\t\tname: form.elements.inputName.value,\n\t\temail: form.elements.inputEmail.value,\n\t\ttext: form.elements.inputText.value,\n\t\tinputFile: form.elements.inputFile.value\n\t}\n\treturn comment;\n}\n// функция очистки данных в форме обратной связи\nfunction clearFormData(){\n\tvar form = document.forms.feedback;\n\tform.elements.inputName.value = \"\";\n\tform.elements.inputEmail.value = \"\";\n\tform.elements.inputText.value = \"\";\n\tform.elements.inputFile.value = \"\";\n}\n\nfunction preview(){\n\tvar comment = getFormData();\n\tcomment.id = \"preview\";\n\tcomment.create_time = new Date().toLocaleString(\"ru\");\n\n\tvar preveiwComment = document.createElement(\"div\");\n \tpreveiwComment.innerHTML = createCommentTemplate(comment);\n\n \t// добавляем preview html-блок с комментарием на страницу\n\tdocument.getElementById(\"preview\").appendChild(preveiwComment);\n\n\tdocument.getElementById(\"form-feedback\").style.display = \"none\";\n\tdocument.getElementById(\"previewBtn\").style.display = \"none\";\n\tdocument.getElementById(\"cancelPreviewBtn\").style.display = \"block\";\n}\nfunction cancelPreview(){\n\tdocument.getElementById(\"form-feedback\").style.display = \"block\";\n\tdocument.getElementById(\"comment-preview\").remove();\n\tdocument.getElementById(\"previewBtn\").style.display = \"block\";\n\tdocument.getElementById(\"cancelPreviewBtn\").style.display = \"none\";\n\t\n}\n\n\nfunction addCommentRequest(){\n\t// disableEditTextBlock();\n\tupdateCommentsProc = true;\n\tvar comment = getFormData();\n\n\tvar xhr = new XMLHttpRequest();\n\tvar data = JSON.stringify(comment);\n\n\t// console.log(data);\n\txhr.open('POST', serverUrl+'comments', true);//true - асинхронно\n\t// xhr.setRequestHeader('Content-type', 'application/json; charset=utf-8');\n\txhr.send(data);\n\txhr.onreadystatechange = function() {\n\t\tif (xhr.readyState != 4){//отправка данных завершена\n\t\t\treturn;\n\t\t}\n\t\tif (xhr.status != 200) {\n\t\t  console.error( xhr.status + ': ' + xhr.statusText );\n\t\t} else {\n\t\t\tvar result = JSON.parse( xhr.responseText );\n\t\t\tconsole.log(\"result: \"+result.status);\n\n\t\t\tif( result.status ){\n\t\t\t\t//очищаем форму обратнойсвязи\n\t\t\t\tclearFormData();\n\n\t\t\t\t// currentId = null;\n\t\t\t\t// currentText.innerHTML = newText;\n\t\t\t\t// currentText.style.display=\"block\";\n\t\t\t\t// currentText.parentNode.lastChild.remove();\n\t\t\t}\n\t\t  // JSON.parse();\n\t\t  // JSON.stringify();\n\t\t  // console.log( result[0]['text'] );\n\t\t}\n\t\tupdateCommentsProc = false;\n\t}\n}\n\n// функция получения данных из формы авторизации\nfunction getSigninFormData(){\n\tvar form = document.forms.signin;\n\tvar credential = {\n\t\tlogin: form.elements.inputSigninLogin.value,\n\t\tpassword: form.elements.inputSigninPassword.value\n\t}\n\treturn credential;\n}\nfunction signIn(){\n\tvar credential = getSigninFormData();\n\n\tvar xhr = new XMLHttpRequest();\n\tvar data = JSON.stringify(credential);\n\n\tconsole.log(data);\n\txhr.open('POST', serverUrl+'signin', true);\n\txhr.send(data);\n\txhr.onreadystatechange = function() {\n\t\tif (xhr.readyState != 4){//отправка данных завершена\n\t\t\treturn;\n\t\t}\n\t\tif (xhr.status != 200) {\n\t\t  console.error( xhr.status + ': ' + xhr.statusText );\n\t\t} else {\n\t\t\t// console.log(xhr.responseText);\n\t\t\tvar result = JSON.parse( xhr.responseText );\n\t\t\tconsole.log(\"signIn() session_id: \"+result.session_id);\n\n\t\t\tif( result.status ){\n\t\t\t\t//очищаем форму обратнойсвязи\n\t\t\t\t// clearFormData();\n\t\t\t\t\n\t\t\t\tuser.login = result.login;\n\t\t\t\tuser.session_id = result.session_id;\n\t\t\t\tdocument.getElementById(\"userLogin\").innerHTML = user.login;\n\t\t\t\tdocument.getElementById(\"form-signin\").style.display = \"none\";\n\t\t\t\tdocument.getElementById(\"form-signout\").style.display = \"block\";\n\n\t\t\t\tgetCommentsRequest();\n\t\t\t}else{\n\t\t\t\talert(\"Неверный Логин или Пароль !\");\n\t\t\t}\n\t\t}\n\t}\n}\nfunction signOut(){\n\tdocument.getElementById(\"form-signin\").style.display = \"block\";\n\tdocument.getElementById(\"form-signout\").style.display = \"none\";\n\tdocument.getElementById(\"userLogin\").innerHTML = \"\";\t\n}"],"sourceRoot":"/source/"}