"use strict";function getCommentsRequest(){wrapper.innerHTML="Загрузка...";var e=new XMLHttpRequest;e.open("GET",serverUrl+"comments",!0),e.send(),e.onreadystatechange=function(){4==e.readyState&&(200!=e.status?console.error(e.status+": "+e.statusText):(wrapper.innerHTML="",console.log("getCommentsRequest session_id: "+e.responseText)))}}function addComments(e){for(var t=e.length-1;t>=0;t--){var n=createCommentTemplate(e[t]),s=document.createElement("div");s.innerHTML=n,wrapper.appendChild(s)}}function createCommentTemplate(e){var t='<div class="panel panel-default" id="comment-'+e.id+'">\n	      <div class="panel-heading">\n	        <div class="row">\n	          <div class="col-sm-6">\n	            <h3 class="panel-title">'+e.name+" ("+e.email+')</h3>\n	          </div>\n	          <div class="col-sm-6">\n	            <h5 class="panel-title add-date"><span class="admin-edit">'+isEdited(e.is_edited)+"</span> "+e.create_time+'</h5>\n	          </div>\n	        </div>\n	      </div>\n	      <div class="panel-body" onclick="startEditText(\''+e.id+'\')" id="text-'+e.id+'">'+e.text+"</div>\n	    </div>";return t}function isEdited(e){return 1==e?"изменен администратором":""}function editCommentTemplate(e,t){var n='<div class="panel-body">\n			<textarea class="form-control" id="newText" rows="3" placeholder="newText" >'+t+'</textarea>\n			<p>\n			<div class="form-inline" style="text-align: right;">\n	    		<button class="btn btn-default" id="saveNewTextBtn" onclick="updateCommentsRequest(\''+e+'\')">Сохранить</button>\n	      		<button class="btn btn-default" id="cancelNewTextBtn" onclick="cancelEditText()">Отмена</button>\n      		</div>\n		</div>';return n}function startEditText(e){if("preview"!==e&&!updateCommentsProc){null!=currentId&&cancelEditText(currentId),currentId=e;var t=document.getElementById("text-"+currentId),n=document.createElement("div");n.innerHTML=editCommentTemplate(currentId,t.innerHTML),t.style.display="none",t.parentNode.appendChild(n)}}function cancelEditText(){var e=document.getElementById("text-"+currentId);e.style.display="block",e.parentNode.lastChild.remove(),currentId=null}function saveEditText(e){var t=document.getElementById("text-"+e),n=document.getElementById("newText").value;updateCommentsRequest(e,n)&&(t.innerHTML=n),t.style.display="block",t.parentNode.lastChild.remove()}function updateCommentsRequest(e){disableEditTextBlock(),updateCommentsProc=!0;var t=document.getElementById("text-"+e),n=document.getElementById("newText").value,s=new XMLHttpRequest,a=JSON.stringify({id:e,newText:n});s.open("PUT",serverUrl+"comments",!0),s.send(a),s.onreadystatechange=function(){if(4==s.readyState){if(200!=s.status)console.error(s.status+": "+s.statusText);else{var e=JSON.parse(s.responseText);console.log(e.status),e.status&&(currentId=null,t.innerHTML=n,t.style.display="block",t.parentNode.lastChild.remove())}updateCommentsProc=!1}}}function disableEditTextBlock(){document.getElementById("newText").disabled=!0,document.getElementById("saveNewTextBtn").disabled=!0,document.getElementById("cancelNewTextBtn").disabled=!0}function enableEditTextBlock(){document.getElementById("newText").disabled=!1,document.getElementById("saveNewTextBtn").disabled=!1,document.getElementById("cancelNewTextBtn").disabled=!1}function getFormData(){var e=document.forms.feedback,t={name:e.elements.inputName.value,email:e.elements.inputEmail.value,text:e.elements.inputText.value,inputFile:e.elements.inputFile.value};return t}function clearFormData(){var e=document.forms.feedback;e.elements.inputName.value="",e.elements.inputEmail.value="",e.elements.inputText.value="",e.elements.inputFile.value=""}function preview(){var e=getFormData();e.id="preview",e.create_time=(new Date).toLocaleString("ru");var t=document.createElement("div");t.innerHTML=createCommentTemplate(e),document.getElementById("preview").appendChild(t),document.getElementById("form-feedback").style.display="none",document.getElementById("previewBtn").style.display="none",document.getElementById("cancelPreviewBtn").style.display="block"}function cancelPreview(){document.getElementById("form-feedback").style.display="block",document.getElementById("comment-preview").remove(),document.getElementById("previewBtn").style.display="block",document.getElementById("cancelPreviewBtn").style.display="none"}function addCommentRequest(){updateCommentsProc=!0;var e=getFormData(),t=new XMLHttpRequest,n=JSON.stringify(e);t.open("POST",serverUrl+"comments",!0),t.send(n),t.onreadystatechange=function(){if(4==t.readyState){if(200!=t.status)console.error(t.status+": "+t.statusText);else{var e=JSON.parse(t.responseText);console.log("result: "+e.status),e.status&&clearFormData()}updateCommentsProc=!1}}}function getSigninFormData(){var e=document.forms.signin,t={login:e.elements.inputSigninLogin.value,password:e.elements.inputSigninPassword.value};return t}function signIn(){var e=getSigninFormData(),t=new XMLHttpRequest,n=JSON.stringify(e);console.log(n),t.open("POST",serverUrl+"signin",!0),t.send(n),t.onreadystatechange=function(){if(4==t.readyState)if(200!=t.status)console.error(t.status+": "+t.statusText);else{var e=JSON.parse(t.responseText);console.log("signIn() session_id: "+e.session_id),e.status?(user.login=e.login,user.session_id=e.session_id,document.getElementById("userLogin").innerHTML=user.login,document.getElementById("form-signin").style.display="none",document.getElementById("form-signout").style.display="block",getCommentsRequest()):alert("Неверный Логин или Пароль !")}}}function signOut(){document.getElementById("form-signin").style.display="block",document.getElementById("form-signout").style.display="none",document.getElementById("userLogin").innerHTML=""}document.addEventListener("DOMContentLoaded",getCommentsRequest);var serverUrl="https://operun.herokuapp.com/api/",wrapper=document.getElementById("wrapper"),comments=[],currentId=null,updateCommentsProc=!1,user={login:"",session_id:""};
//# sourceMappingURL=main.min.js.map
